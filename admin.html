<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <!-- Include Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 500px; margin: 0 auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input { width: 100%; padding: 8px; box-sizing: border-box; }
        button { background: #007bff; color: white; border: none; padding: 10px 15px; cursor: pointer; }
        .message { padding: 10px; margin-top: 15px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>Admin Panel - Add Balance</h1>
    
    <div class="form-group">
        <label for="email">User Email:</label>
        <input type="email" id="email" required>
    </div>
    
    <div class="form-group">
        <label for="amount">Amount to Add ($):</label>
        <input type="number" id="amount" min="0.01" step="0.01" required>
    </div>
    
    <button onclick="addBalance()">Add Balance</button>
    
    <div id="message" class="message"></div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDSiJV8jaWK4rNNoBGFIA6JNACEDQJXbOY",
            authDomain: "cryptophase-wallet.firebaseapp.com",
            projectId: "cryptophase-wallet",
            storageBucket: "cryptophase-wallet.appspot.com",
            messagingSenderId: "1070932487803",
            appId: "1:1070932487803:web:025cc748f3ebc16ec6bcde",
            measurementId: "G-2VSNVW89V6"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Admin email (replace with your admin email)
        const ADMIN_EMAIL = "officialvideofunds@gmail.com";

        // Check if user is admin
        auth.onAuthStateChanged(user => {
            if (!user || user.email !== officialvideofunds@gmail.com) {
                document.body.innerHTML = `
                    <h1>Access Denied</h1>
                    <p>You must be an admin to access this page.</p>
                    <a href="index.html">Go to Home</a>
                `;
            }
        });

        // Add balance function
        async function addBalance() {
            const email = document.getElementById('email').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const messageDiv = document.getElementById('message');
            
            messageDiv.textContent = "Processing...";
            messageDiv.className = "message";

            try {
                // Find user by email
                const usersRef = db.collection('users');
                const querySnapshot = await usersRef.where('email', '==', email).get();
                
                if (querySnapshot.empty) {
                    throw new Error("User not found");
                }
                
                // Update balance
                const userDoc = querySnapshot.docs[0];
                const currentBalance = userDoc.data().balance || 0;
                const newBalance = currentBalance + amount;
                
                await userDoc.ref.update({ balance: newBalance });
                
                messageDiv.textContent = `Success! Added $${amount} to ${email}. New balance: $${newBalance}`;
                messageDiv.className = "message success";
                
                // Clear inputs
                document.getElementById('email').value = "";
                document.getElementById('amount').value = "";
            } catch (error) {
                messageDiv.textContent = `Error: ${error.message}`;
                messageDiv.className = "message error";
            }
        }
    </script>
</body>
</html>